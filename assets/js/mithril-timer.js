webpackJsonp([4],[function(t,e,i){(function(t){"use strict";function e(){var e=parseInt(t("[name=current]:input").val()),i=parseInt(t("[name=objective]:input").val()),s=(new Date).getTime(),o=m.reduce(function(t,e){return t+Math.max(e[1],s)-Math.max(e[0],s)},0),a=Math.max(i-e,0),r=o/864e5,l=a/Math.max(r,1),h=o/36e5,c=a/Math.max(h,1),u=o/18e5,d=a/Math.max(u,1),p=n(l,3).split(".");t("#norma_per_day").find(".norma-amount-actual").text(p[0]).parent().find(".norma-amount-fraction").text("."+p[1]).parent(),p=n(c,3).split("."),t("#norma_per_hour").find(".norma-amount-actual").text(p[0]).parent().find(".norma-amount-fraction").text("."+p[1]).parent(),p=n(d,3).split("."),t("#norma_per_minute").find(".norma-amount-actual").text(p[0]).parent().find(".norma-amount-fraction").text("."+p[1]).parent(),t("#remains_days").text(n(r,0)),t("#remains_hours").text(n(h,0)),t("#remains_minutes").text(n(60*h,0));var f,g=100*Math.min(e,i),v=parseInt(g/i)||0,b=N-o,y=parseInt(100*b/N)||0;f=100==v?"progress-bar-success":v>=y?"progress-bar-success":v>.7*y?"progress-bar-info":v>.4*y?"progress-bar-warning":"progress-bar-danger",t("#objective_progress > .progress-bar").width(v+"%").removeClass("progress-bar-success progress-bar-info progress-bar-danger progress-bar-warning").addClass(f).children("span").text(v+"%達成"),t("#period_progress > .progress-bar").width(y+"%").children("span").text(y+"%経過");var _=e*N/b;t("#prediction_collection").text(n(Math.floor(_)));var x=Math.min(_/i,1),w=t("#objective_progress").width(),k=w*x-47;t(".pointer").css("left",k+"px");var C=230>w-k?-250:0;t(".pointer-label").css("margin-left",C+"px");var T="";if(i>e&&_>=i){var S,D;m.forEach(function(t){S=S||t[0],D=D||t[1]});var I=i/_*N,E=m.reduce(function(t,e){if(t)return t;var i=e[1]-e[0];return I>i?(I-=i,null):new Date(e[0]+I)},null),M=E.getMonth(),P=E.getDate(),A=E.getHours(),z=E.getMinutes(),O=M+1+"/"+P+" "+(10>A?"0"+A:A)+":"+(10>z?"0"+z:z);T=O+"頃に目標達成できそうよ。"}t("#prediction_completion_date").text(T)}function n(t,e){if(e=e||0,isNaN(t))return"?";if(t===1/0||t===-(1/0))return"∞";var i=t.toFixed(e).split("."),n=parseInt(i[0]);return n.toLocaleString()+(1===i.length?"":"."+i[1])}function s(){if(I){var e=t("#map").find("tbody tr input[name=num_drops]").map(function(){return parseInt(t(this).val())||0}).toArray().reduce(function(t,e){return t+e},0);t("input[name=current]").val(e).trigger("change")}}function o(){var e=(new Date).getTime(),i=t("#period_dates");if(m.forEach(function(n){var s=n[1]-n[0],o=100*s/N+"%",a=new Date(n[0]),r=new Date(n[1]-1),l=a.getMonth()+1+"/"+a.getDate()+"-"+(r.getMonth()+1)+"/"+r.getDate(),h=e>=n[0]&&e<n[1],c=e>=n[1],u=h?"progress-bar-active":c?"progress-bar-expired":"progress-bar-remain";t('<div class="progress-bar">').width(o).text(l).addClass(u).appendTo(i)}),t('[data-objective-mode="'+g+'"]').show(),t('[data-objective-mode][data-objective-mode!="'+g+'"]').remove(),t("[name=current]:input").click(function(){this.select()}).TouchSpin({min:0,max:v,step:1}),"achievement"==g){var o=t("[name=objective]:input");t.each(E,function(e,i){t("<option />").attr("value",e).text(i+" ("+e+"個)").appendTo(o)})}else{t("select[name=objective]").click(function(){this.select()});var b=t("#increse_objective_list");M.forEach(function(e){t('<button class="btn btn-default" name="add"  type="button" />').val(e.value).attr("title",e.name).append(t('<i class="fa fa-arrow-up" />')).append(t("<span />").addClass("icon icon-"+e.unit)).appendTo(b)})}t("button[name=add]").click(function(e){e.preventDefault();var i=parseInt(t(this).val()),n=parseInt(t("[name=objective]:input").val());t("[name=objective]:input").val(n+i).trigger("change")}),t("button[name=reset]").click(function(e){e.preventDefault(),t("[name=objective]:input").val(0).trigger("change")}),t("[name=expectation]:input").change(function(){c(),u()}).val(S);var y=t("#prize_list");M.forEach(function(e){t('<div class="prize-list" />').append(t('<h4 class="prize-list-header" />').text(e.name).append(t('<span class="prize-value" />').text("@"+e.value))).append(t('<div class="prize-list-body" />').attr("data-prize",e.unit)).appendTo(y)});var x=P.reduce(function(t,e){return Math.max(t,e.drops.length)},0),w=a();w.maps.forEach(function(t,e){P[e].expectation=t.expectation}),I=w.syncCurrentEnabled;var k=function(){var e=t("#map");P.forEach(function(t,i){var s=e.find("tr[data-map="+i+"]"),o=Math.max(parseInt(s.find("input[name=num_laps]").val())||0,0),a=Math.max(parseInt(s.find("input[name=num_drops]").val())||0,0),r=s.find("input[name=actual_expectation]"),l=Math.max(parseFloat(r.val())||0,0);"aggregate"===D&&(l=a/o||0,r.val(l));var h=Math.floor(l);s.find("button[name=increase]").val(h).text("+"+n(h)),w.maps[i].numLaps=o,w.maps[i].numDrops=a,t.expectation=w.maps[i].expectation=l}),r(w),d(),c(),u()},C=t("#map").on("keyup","input[type=number]",function(){k(),s()}).on("change","input[type=number]",function(){k(),s()}).on("click","input[type=number]",function(){this.select()}).on("click","button[name=increase]",function(e){e.preventDefault();var i=t(this).closest("tr"),n=i.find("input[name=num_laps]"),s=parseInt(n.val())+1;n.val(s);var o=i.find("input[name=num_drops]"),a=parseInt(o.val())+parseInt(this.value);o.val(a),o.trigger("change")}).on("change","input[name=expectation_input_mode]",function(){D=t(this).val(),w.expectationInputMode=D,r(w),C.find("input[name=num_laps], input[name=num_drops]").parent().toggle("aggregate"===D).end().end().find("input[name=actual_expectation]").parent().toggle("direct"===D).end().end().find("input[name=sync]").closest("tfoot").toggle("aggregate"===D),k()}).on("click","input[name=sync]",function(){w.syncCurrentEnabled=I=this.checked,r(w),s()}),T=C.find("tbody");if(P.forEach(function(e,i){var n=w.maps[i],s=t("<td />").attr("data-chart",i).append(t('<span class="barchart" />')).append(t('<span class="barchart-label" />')).append(t('<span class="marathon" />'));t("<tr />").attr("data-map",i).append(t("<th />").text(e.name)).append(t("<td />").text(""+e.charisma+"/"+e.stamina)).append(function(){for(var i=e.drops.map(function(e){var i=e.icon?t("<i />").attr("title",e.name).addClass("icon icon-"+e.icon):t("<span />").text(e.name),n=e.set?t('<span class="badge" />').text("x"+e.set):null;return t("<td />").append(i).append(n)}),n=e.drops.length;x>n;n++)i.push(t("<td />"));return i}).append(function(){var e=t('<span class="input-group input-group-sm" />').append(t('<span class="input-group-addon">1周の期待値</span>')).append(t('<input type="number" name="actual_expectation" min="0" class="form-control" />').val(n.expectation)),i=t('<span class="input-group input-group-sm" />').append(t('<span class="input-group-addon">周回</span>')).append(t('<input type="number" name="num_laps" min="0" class="form-control" />').val(n.numLaps)).append(t('<span class="input-group-addon">ドロップ</span>')).append(t('<input type="number" name="num_drops" min="0" class="form-control" />').val(n.numDrops)).append(t('<span class="input-group-btn"><button name="increase" class="btn btn-default"></button></span>'));return t('<td class="expectation" />').append(i).append(e)}).append(s).prependTo(T)}),t("#map thead th.drops").attr("colspan",x),_){var z=t("#rewards tbody");A.forEach(function(e){t("<tr />").attr("data-amount",e.amount).append(t('<td class="text-right" />').html('<span class="diff"></span> '+e.amount)).append(t("<td />").html('<span class="icon icon-'+e.unit+'"></span>')).appendTo(z)})}var O=t("[name=estimate_map]:input").change(function(){d(),w.estimateMap=parseInt(t(this).val()),r(w)});P.forEach(function(e,i){t("<option />").val(i).text(e.name+" ("+e.charisma+"/"+e.stamina+")").prependTo(O)});for(var F=t("[name=estimate_rank]:input").change(function(){d(),w.estimateRank=parseInt(t(this).val()),r(w)}),H=1;200>=H;H++){var $=p(H),R=f(H),j=""+H+" ("+$+"/"+R+")";t("<option />").val(H).text(j).appendTo(F)}var W=t("[name=estimate_use_crystal]").change(function(){d(),w.estimateUseCrystal=t(this).val(),r(w)}),L=t("[name=estimate_natural_recovery]:input").change(function(){d(),w.estimateNaturalRecovery=this.checked,r(w)});t("*[title]").tooltip(),t("[name=current]:input").val(w.current),"exchange"==g?t("[name=objective]:input").val(w.objective):t("[name=objective]:input").val([w.objective]),t("[name=current]:input, [name=objective]:input").change(function(){w[this.name]=t(this).val(),r(w),l(),h(),u(),d()}),O.val(w.estimateMap),F.val(w.estimateRank),W.val(w.estimateUseCrystal),L.prop("checked",w.estimateNaturalRecovery),"exchange"==g&&h(),_&&l(),C.find("input[name=sync]").prop("checked",I).end().find('input[name=expectation_input_mode][value="'+w.expectationInputMode+'"]').prop("checked",!0).trigger("change").parent().addClass("active")}function a(){var e={},i=P.map(function(t){return{numLaps:0,numDrops:0,expectation:t.expectation}}),n={current:y,objective:b,estimateMap:w,estimateRank:k,estimateUseCrystal:C,estimateNaturalRecovery:T,expectationInputMode:D,maps:i,syncCurrentEnabled:I};try{e=JSON.parse(t.cookie(x))}catch(s){}return t.extend(!0,n,e)}function r(e){t.cookie(x,JSON.stringify(e),{expires:30})}function l(){if(_){var e=45,i=7,n=parseInt(t("[name=current]:input").val()),s=t("#rewards tbody");s.find("tr").removeClass("active").each(function(){var s=t(this),o=s.attr("data-amount")-n;if(-e>o)s.hide();else if(0>o)s.css("opacity",.5).show();else if(e>o)s.addClass("active").css("opacity",1).show();else if(e*i>o){var a=1-Math.floor(o/e)*e/(e*(i+1));s.show().css("opacity",a)}else s.hide();var r=0===o?"diff-eq":o>0?"diff-plus":"diff-minus",l=0===o?"":(o>0?"+":"")+o;s.find("span.diff").removeClass("diff-eq diff-plus diff-minus").addClass(r).text(l)})}}function h(){if("exchange"==g){var e=parseInt(t("[name=current]:input").val());M.forEach(function(i){for(var n=t('[data-prize="'+i.unit+'"]').empty(),s=0;e>s;s+=i.value){var o=t("<i />").addClass("icon icon-"+i.unit),a=25*Math.min(e-s,i.value)/i.value;t('<div class="prize-gage" />').append(o.clone().css({position:"absolute",opacity:.2,boxShadow:"none",paddingRight:25-a})).append(o.clone().css({width:a+"px"})).appendTo(n)}})}}function c(){var e=t("[name=expectation]:input").val(),i=1/0,s=0,o="drop"==e?null:e,a=P.map(function(t){var e=t.expectation/(o&&t[o]||1);return i=0,s=Math.max(s,e),e}),r=o?3:2;P.forEach(function(e,o){var l=t("[data-chart="+o+"]"),h=a[o],c=h/(s-i),u=120*c+240;l.find("span.barchart-label").text(n(h,r)+"個"),l.find("span.barchart").css({width:100*c+"%",backgroundColor:"hsla("+u+", 80%, 50%, 0.5)"})})}function u(){var e=parseInt(t("[name=objective]:input").val()),i=parseInt(t("[name=current]:input").val()),s=Math.max(e-i,0);P.forEach(function(e,i){var o=t("[data-chart="+i+"]"),a=s?Math.ceil(s/e.expectation):0;o.find("span.marathon").text("残り"+n(a)+"周")})}function d(){var e=parseInt(t("[name=current]:input").val()),i=parseInt(t("[name=objective]:input").val()),s=P[parseInt(t("[name=estimate_map]:input").val())],o=Math.max(i-e,0),a=Math.ceil(o/s.expectation);t("#estimate_required_marathon").text(n(a));var r=(new Date).getTime(),l=m.reduce(function(t,e){return t+Math.max(e[1],r)-Math.max(e[0],r)},0),h=0+t("[name=estimate_natural_recovery]:input").prop("checked"),c=Math.floor(l/18e4)*h,u=Math.floor(l/36e5)*h,d=parseInt(t("[name=estimate_rank]").val()),g=p(d),v=f(d),b=Math.ceil(s.charisma*a),y=Math.ceil(s.stamina*a),_=t("[name=estimate_use_crystal]:input").val(),x=0+("both"===_||"charisma"===_),w=0+("both"===_||"stamina"===_),k=Math.ceil(Math.max(b-c,0)/g)*x,C=Math.ceil(Math.max(y-u,0)/v)*w,T=k+C;t("#estimate_required_crystal").text(n(T));var S=0===k?"diff-eq":k>0?"diff-plus":"diff-minus";t("#estimate_required_crystal_for_charisma").attr("class",S).text(n(k)),S=0===C?"diff-eq":C>0?"diff-plus":"diff-minus",t("#estimate_required_crystal_for_stamina").attr("class",S).text(n(C));var D=c+g*k,I=u+v*C,E=Math.floor(Math.min(D/s.charisma,I/s.stamina,a));t("#estimate_available_marathon").text(n(E));var M=E-a;S=0===M?"diff-eq":M>0?"diff-plus":"diff-minus";var A=(M>=0?"+":"")+n(M);t("#estimate_available_marathon_diff").attr("class",S).text(A);var N=s.charisma*E;t("#estimate_using_charisma").text(n(N)),M=N-b,S=0===M?"diff-eq":M>0?"diff-plus":"diff-minus",A=(M>=0?"+":"")+n(M),t("#estimate_using_charisma_diff").attr("class",S).text(A);var z=Math.ceil(s.stamina*E);t("#estimate_using_stamina").text(n(z)),M=z-y,S=0===M?"diff-eq":M>0?"diff-plus":"diff-minus",A=(M>=0?"+":"")+n(M),t("#estimate_using_stamina_diff").attr("class",S).text(A);var O=e+Math.ceil(s.expectation*E);t("#estimate_result_collection").text(n(O)),M=O-i,S=0===M?"diff-eq":M>0?"diff-plus":"diff-minus",A=(M>=0?"+":"")+n(M),t("#estimate_result_collection_diff").attr("class",S).text(A)}function p(t){return 27+(100>=t?3*t:300+t-100)}function f(t){return 12+(100>=t?0:Math.floor((t-100)/20)+1)}i(10);var m=[["2015/06/11 15:00:00","2015/06/18 10:00:00"],["2015/06/18 15:00:00","2015/06/25 10:00:00"]].map(function(t){return t.map(Date.parse)}),g="achievement",v=1/0,b=1500,y=20,_=!0,x="mithril-timer",w=3,k=100,C="both",T=!0,S="stamina",D="direct",I=!0,E={25:"セラが仲間になる",50:"スキルレベル2",100:"初期レベル10",150:"スキルレベル3",200:"出撃コスト-1",250:"スキルレベル4",300:"出撃コスト-2",400:"スキルレベル5",500:"初期レベル20",600:"スキルレベル6",700:"出撃コスト-3",800:"スキルレベル7",900:"初期レベル30",1000:"スキルレベル8",1100:"出撃コスト-4",1200:"初期レベル40",1300:"スキルレベル9",1400:"出撃コスト-5",1500:"スキルレベル10",1600:"初期レベル50"},M=[],P=[{name:"ミスリルの洞窟",charisma:20,stamina:1,expectation:0,drops:[{name:"ミスリル鉱1",icon:"mithril-1",set:1}]},{name:"硬質の魔物",charisma:30,stamina:2,expectation:0,drops:[{name:"ミスリル鉱1",icon:"mithril-1",set:3},{name:"ハリッサ",icon:"harissa"},{name:"魔水晶1",icon:"demon-crystal-1"}]},{name:"ミスリル争奪戦",charisma:40,stamina:4,expectation:0,drops:[{name:"ミスリル鉱3",icon:"mithril-3",set:2},{name:"ミスリル鉱1",icon:"mithril-1",set:1},{name:"モーティマ",icon:"motima"},{name:"花束",icon:"flower"}]},{name:"交錯する陣容",charisma:50,stamina:7,expectation:11,drops:[{name:"ミスリル鉱3",icon:"mithril-3",set:3},{name:"ミスリル鉱1",icon:"mithril-1",set:2},{name:"カズハ",icon:"kazuha"},{name:"魔水晶2",icon:"demon-crystal-2"}]},{name:"怒涛の炎獣",charisma:80,stamina:9,expectation:0,drops:[{name:"ミスリル鉱5",icon:"mithril-5",set:4},{name:"フドウ",icon:"fudou"},{name:"白バケツ",icon:"platinum-bucket"},{name:"極上酒",icon:"hq-liquor"}]},{name:"痺れる毒針",charisma:40,stamina:5,expectation:0,drops:[{name:"ミスリル鉱3",icon:"mithril-3",set:2},{name:"ミスリル鉱1",icon:"mithril-1",set:1},{name:"カズハ",icon:"rosalie"},{name:"白精霊",icon:"platinum-sprit"}]},{name:"目覚まし機甲兵",charisma:70,stamina:8,expectation:0,drops:[{name:"ミスリル鉱5",icon:"mithril-5",set:2},{name:"ミスリル鉱3",icon:"mithril-3",set:2},{name:"アリサ",icon:"arisa"},{name:"ルビー",icon:"ruby"}]},{name:"魔の決戦兵器",charisma:90,stamina:12,expectation:0,drops:[{name:"ミスリル鉱5",icon:"mithril-5",set:4},{name:"ミスリル鉱3",icon:"mithril-3",set:3},{name:"虹精霊",icon:"rainbow-sprit"}]},{name:"決戦",charisma:100,stamina:2,expectation:0,drops:[{name:"金精霊",icon:"gold-sprit"},{name:"白精霊",icon:"platinum-sprit"},{name:"黒精霊",icon:"black-sprit"},{name:"虹精霊",icon:"rainbow-sprit"}]}],A=[{amount:45,unit:"gold-bucket"},{amount:90,unit:"gold-sprit"},{amount:135,unit:"platinum-bucket"},{amount:180,unit:"gold-sprit"},{amount:225,unit:"crystal-fragment"},{amount:270,unit:"platinum-sprit"},{amount:315,unit:"gold-bucket"},{amount:360,unit:"platinum-sprit"},{amount:405,unit:"platinum-bucket"},{amount:450,unit:"black-sprit"},{amount:495,unit:"crystal-fragment"},{amount:540,unit:"black-sprit"},{amount:585,unit:"gold-bucket"},{amount:630,unit:"rainbow-sprit"},{amount:675,unit:"platinum-bucket"},{amount:720,unit:"platinum-sprit"},{amount:765,unit:"crystal-fragment"},{amount:810,unit:"platinum-sprit"},{amount:855,unit:"gold-bucket"},{amount:900,unit:"black-sprit"},{amount:945,unit:"platinum-bucket"},{amount:990,unit:"platinum-sprit"},{amount:1035,unit:"crystal-fragment"},{amount:1080,unit:"platinum-sprit"},{amount:1125,unit:"gold-bucket"},{amount:1170,unit:"black-sprit"},{amount:1215,unit:"platinum-bucket"},{amount:1260,unit:"black-sprit"},{amount:1305,unit:"crystal-fragment"},{amount:1350,unit:"rainbow-sprit"},{amount:1395,unit:"gold-bucket"},{amount:1440,unit:"platinum-sprit"},{amount:1485,unit:"platinum-bucket"},{amount:1530,unit:"platinum-sprit"},{amount:1575,unit:"crystal-fragment"},{amount:1620,unit:"black-sprit"},{amount:1665,unit:"gold-bucket"},{amount:1710,unit:"black-sprit"},{amount:1755,unit:"platinum-bucket"},{amount:1800,unit:"rainbow-sprit"}],N=m.reduce(function(t,e){return t+e[1]-e[0]},0);t(function(){o(),setInterval(e,1e3)})}).call(e,i(2))}]);