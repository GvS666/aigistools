webpackJsonp([4],{0:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}var o=i(32),s=n(o),r=i(196),a=n(r);document.addEventListener("DOMContentLoaded",function(){s["default"].render(s["default"].createElement(a["default"],null),document.getElementById("massgame"))})},196:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(t,e,i){for(var n=!0;n;){var o=t,s=e,r=i;a=c=l=void 0,n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,s);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(r)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;t=c,e=s,i=r,n=!0}},l=i(32),c=n(l),u=i(197),h=n(u),p=i(199),d=n(p),f=i(208),m=n(f),g=i(201),v=n(g),y=v["default"].messageActions,b=v["default"].messageStore,_=function(t){function e(t){o(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.state={message:null,updating:!1},this.messageChangedHandler=null}return s(e,t),r(e,[{key:"componentWillMount",value:function(){this.messageChangedHandler=this.handleMessageChanged.bind(this),b.addListener("changed",this.messageChangedHandler),y.restoreMessage()}},{key:"componentWillUnmount",value:function(){b.removeListener("changed",this.messageChangedHandler)}},{key:"render",value:function(){var t=this,e=this.state.message,i=this.state.updating,n=["massgame",i?"updating":""].join(" ");return c["default"].createElement("div",{className:n},c["default"].createElement(h["default"],{data:e,onChange:function(e){t.handleMessageEditorChange(e)}}),c["default"].createElement(d["default"],{key:"view",data:e}),c["default"].createElement(m["default"],{key:"export",data:e}))}},{key:"handleMessageChanged",value:function(){this.setState({message:b.currentMessage})}},{key:"handleMessageEditorChange",value:function(t){y.updateMessage(t)}}]),e}(c["default"].Component);e["default"]=_,t.exports=e["default"]},197:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(t,e,i){for(var n=!0;n;){var o=t,s=e,r=i;a=c=l=void 0,n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,s);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(r)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;t=c,e=s,i=r,n=!0}},l=i(32),c=n(l),u=i(198),h=(n(u),function(t){function e(t){o(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.state={enabled:!!t.data},this.changeEmitTimer=null,this.changeEmitDelay=100}return s(e,t),r(e,[{key:"componentWillReceiveProps",value:function(t){var e=t.data,i=!!e;this.setState({enabled:i}),e&&(this.refs.text.getDOMNode().value=e.text)}},{key:"render",value:function(){var t=this.state.enabled,e=this.props.data,i=e?e.text:"";return c["default"].createElement("form",{className:"form form--message-edit",onSubmit:this.handleSubmit.bind(this)},c["default"].createElement("div",{className:"form-group"},c["default"].createElement("input",{type:"text",ref:"text",className:"form-control",defaultValue:i,placeholder:"メッセージ",disabled:!t,onChange:this.handleChange.bind(this)})))}},{key:"handleSubmit",value:function(t){t.preventDefault()}},{key:"handleChange",value:function(t){var e=this,i=this.props.data;i&&(this.changeEmitTimer&&clearTimeout(this.changeEmitTimer),i.text=this.refs.text.getDOMNode().value,this.changeEmitTimer=setTimeout(function(){e.props.onChange(i)},this.changeEmitDelay))}}]),e}(c["default"].Component));e["default"]=h,h.defaultProps={value:null},t.exports=e["default"]},198:function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(e){var n=this;i(this,t),this.text="",this.fontFamily="monospace",this.fontSize=10,this.letterSpace=1,this.dot=null,this.background=null,this.loaded=!1,this.origin={x:0,y:0},this.padding={x:0,y:0},this.dotImage=null,this.backgroundImage=null,Object.keys(e).forEach(function(t){n[t]=e[t]})}return n(t,[{key:"loadResources",value:function(){var t=this,e=["dot","background"].filter(function(e){return null!==t[e]}),i=e.map(function(e){return new Promise(function(i,n){var o=new Image;o.crossOrigin="Anonymous",o.onload=i,o.onerror=n,t[e+"Image"]=o,o.src=t[e]})});return Promise.all(i).then(function(){t.loaded=!0})}}]),t}();e["default"]=o,t.exports=e["default"]},199:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(t,e,i){for(var n=!0;n;){var o=t,s=e,r=i;a=c=l=void 0,n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,s);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(r)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;t=c,e=s,i=r,n=!0}},l=i(32),c=n(l),u=i(200),h=n(u),p=(i(26),i(201)),d=n(p),f=function(t){function e(t){o(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.state={loaded:!1,hasError:!1}}return s(e,t),r(e,[{key:"componentWillReceiveProps",value:function(t){var e=t.data,i=e&&e.loaded;this.setState({loaded:i})}},{key:"componentDidUpdate",value:function(t,e){var i=this.props.data;if(!this.state.hasError)return this.state.loaded?void this.renderMessage(i):void this.loadResources(i)}},{key:"render",value:function(){var t=void 0;return t=this.state.hasError?c["default"].createElement("div",{className:"alert alert-danger"},"Failed to load resources."):this.state.loaded?c["default"].createElement("canvas",{ref:"canvas"}):c["default"].createElement(h["default"],null),c["default"].createElement("div",{className:"message-view"},t)}},{key:"renderMessage",value:function(t){var e=d["default"].messageRenderer,i=this.refs.canvas.getDOMNode();e.render(i,t)}},{key:"loadResources",value:function(t){var e=this;t.loadResources()["catch"](function(t){e.setState({loaded:!0,hasError:!0})}).then(function(){e.setState({loaded:!0,hasError:!1})})}}]),e}(c["default"].Component);e["default"]=f,t.exports=e["default"]},200:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(t,e,i){for(var n=!0;n;){var o=t,s=e,r=i;a=c=l=void 0,n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,s);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(r)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;t=c,e=s,i=r,n=!0}},l=i(32),c=n(l),u=function(t){function e(){o(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return s(e,t),r(e,[{key:"render",value:function(){return c["default"].createElement("div",{className:"loading-indicator"},c["default"].createElement("span",{className:"spinner"},"Loading..."))}}]),e}(c["default"].Component);e["default"]=u,t.exports=e["default"]},201:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(202),a=n(r),l=i(205),c=n(l),u=i(206),h=n(u),p=i(207),d=n(p),f=function(){function t(){o(this,t),this.services={}}return s(t,[{key:"messageDispatcher",get:function(){return this.services.messageDispatcher||(this.services.messageDispatcher=new c["default"])}},{key:"messageActions",get:function(){return this.services.messageActions||(this.services.messageActions=new a["default"](this.messageDispatcher))}},{key:"messageStore",get:function(){return this.services.messageStore||(this.services.messageStore=new d["default"](this.messageDispatcher))}},{key:"messageRenderer",get:function(){return this.services.messageRenderer||(this.services.messageRenderer=new h["default"])}}]),t}();e["default"]=new f,t.exports=e["default"]},202:function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function o(t){return t&&t.__esModule?t:{"default":t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function(t,e,i){for(var n=!0;n;){var o=t,s=e,r=i;a=c=l=void 0,n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,s);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(r)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;t=c,e=s,i=r,n=!0}},c=i(190),u=o(c),h=i(198),p=o(h),d=i(203),f=n(d),m=i(204),g=o(m),v=function(t){function e(t){s(this,e),l(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.dispatcher=t}return r(e,t),a(e,[{key:"restoreMessage",value:function(){var t=this;this.dispatcher.dispatch({type:f.MESSAGE_RESTORING}),setTimeout(function(){var e=t.createDefaultMessage();t.dispatcher.dispatch({type:f.MESSAGE_RESTORED,message:e})})}},{key:"updateMessage",value:function(t){var e=this;this.dispatcher.dispatch({type:f.MESSAGE_UPDATING,message:t}),this.messageChangeTimer=setTimeout(function(){e.dispatcher.dispatch({type:f.MESSAGE_UPDATED,message:t})})}},{key:"createDefaultMessage",value:function(){return new p["default"](g["default"])}}]),e}(u["default"]);e["default"]=v,t.exports=e["default"]},203:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="MESSAGE_RESTORING";e.MESSAGE_RESTORING=i;var n="MESSAGE_RESTORED";e.MESSAGE_RESTORED=n;var o="MESSAGE_UPDATING";e.MESSAGE_UPDATING=o;var s="MESSAGE_UPDATED";e.MESSAGE_UPDATED=s},204:function(t,e){t.exports={text:"THANK YOU",fontFamily:"'ＭＳ ゴシック', monospace",fontSize:10,letterSpace:1,dot:"../assets/massgame/dot.png",background:"../assets/massgame/bg.png",origin:{x:0,y:-50},padding:{x:100,y:0}}},205:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(t,e,i){for(var n=!0;n;){var o=t,s=e,r=i;a=c=l=void 0,n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,s);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(r)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;t=c,e=s,i=r,n=!0}},r=i(187),a=function(t){function e(){n(this,e),s(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return o(e,t),e}(r.Dispatcher);e["default"]=a,t.exports=e["default"]},206:function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=0,s=function(){function t(){i(this,t),this.mask=document.createElement("canvas")}return n(t,[{key:"render",value:function(t,e){console.log("render",o++);var i=e.text,n=e.fontFamily,s=e.fontSize,r=e.letterSpace,a=e.dotImage,l=a.width,c=a.height,u=i.split(/\B/),h=this.mask,p=h.getContext("2d");p.font=""+s+"px "+n;var d=u.reduce(function(t,e){return t+p.measureText(e).width+r},0),f=s;h.width=d,h.height=f,p.fillStyle="rgb(0, 0, 0)",p.fillRect(0,0,d,f),p.strokeStyle="rgb(255, 255, 255)",p.fillStyle="rgb(255, 255, 255)",p.font=""+s+"px "+n,p.textAlign="left",p.textBaseline="top";var m=0;u.forEach(function(t){p.fillText(t,m,0),m+=p.measureText(t).width+1});var g=e.backgroundImage,v=g.width,y=g.height,b=e.padding,_=Math.max(v,l*d+2*b.x),x=Math.max(y,c*f+2*b.y);t.width=_,t.height=x;for(var w=t.getContext("2d"),C=0;x>C;C+=y)for(var E=0;_>E;E+=v)w.drawImage(g,E,C);if(0!==u.length)for(var k=p.getImageData(0,0,d,f).data,D=(_-d*l)/2+e.origin.x,T=(x-f*c)/2+e.origin.y,C=0;f>C;C++)for(var N=0;d>N;N++){var S=4*d*C+4*N,O=k[S],I=k[S+1],M=k[S+2];(O+I+M)/3&128&&w.drawImage(a,D+l*N,T+c*C)}}}]),t}();e["default"]=s,t.exports=e["default"]},207:function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function o(t){return t&&t.__esModule?t:{"default":t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function(t,e,i){for(var n=!0;n;){var o=t,s=e,r=i;a=c=l=void 0,n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,s);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(r)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;t=c,e=s,i=r,n=!0}},c=i(190),u=o(c),h=i(203),p=n(h),d=function(t){function e(t){s(this,e),l(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.currentMessage=null,this.registerDispatcher(t)}return r(e,t),a(e,[{key:"registerDispatcher",value:function(t){var e=this;this.dispatcherToken=t.register(function(t){switch(t.type){case p.MESSAGE_RESTORING:e.emit("restoring"),e.emit("changing");break;case p.MESSAGE_RESTORED:e.currentMessage=t.message,e.emit("restored"),e.emit("changed");break;case p.MESSAGE_UPDATING:e.emit("changing");break;case p.MESSAGE_UPDATED:e.currentMessage=t.message,e.emit("changed")}})}}]),e}(u["default"]);e["default"]=d,t.exports=e["default"]},208:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(t,e,i){for(var n=!0;n;){var o=t,s=e,r=i;a=c=l=void 0,n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,s);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(r)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;t=c,e=s,i=r,n=!0}},l=i(32),c=n(l),u=i(201),h=n(u),p=(h["default"].messageRenderer,function(t){function e(t){o(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.state={enabled:!!t.data},this.downloadFileName="massgame.png",this.contentType="image/png"}return s(e,t),r(e,[{key:"componentWillReceiveProps",value:function(t){var e=t.data;this.setState({enabled:!!e})}},{key:"render",value:function(){var t=(this.props.data,this.state.enabled);return c["default"].createElement("form",{className:"form form--export",onSubmit:this.handleSubmit.bind(this)},c["default"].createElement("div",{className:"form-group"},c["default"].createElement("button",{ref:"download",type:"submit",className:"btn btn-block btn-default btn-lg",disabled:!t},c["default"].createElement("i",{className:"fa fa-download"})," ダウンロード")))}},{key:"handleSubmit",value:function(t){if(t.preventDefault(),this.state.enabled)try{var e=this.props.data,i=h["default"].messageRenderer;this.download(e,i)}catch(n){window.alert("Failed to download operation. "+n)}}},{key:"download",value:function(t,e){var i=document.createElement("canvas");e.render(i,t);var n=i.toDataURL("image/png"),o=document.createElement("a");if("download"in o){o.href=n,o.download=this.downloadFileName;var s=document.createEvent("MouseEvents");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(s)}else{var r=window.open("about:blank","_blank"),a=r.document,l='<!DOCTYPE html><html><body>画像を右クリックして保存して下さい。<br />\n        <img src="'+n+'" /></body></html>';a.open(),a.write(l),a.close()}}}]),e}(c["default"].Component));e["default"]=p,t.exports=e["default"]}});